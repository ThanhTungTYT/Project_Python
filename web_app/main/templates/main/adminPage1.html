{% load static %}
{% load custom_filters %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Trang Quản Trị Aroma Café</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'main/css/admin.css' %}">
<style>
    /* 1. Đẩy thanh lọc xuống một chút cho thoáng khỏi tiêu đề đỏ */
    .filter-section {
        margin-top: 20px; 
    }

    /* 2. Style cho nút CHƯA ĐƯỢC CHỌN (Class này chưa có trong CSS chung) 
       Giúp nút nhìn giống input bình thường, gọn gàng, ít màu mè */
    .filter-section .btn-outline {
        display: flex;
        align-items: center;
        padding: 0 20px;
        height: 38px;
        background: white;       
        color: #495057;          
        border: 1px solid #ced4da; 
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        text-decoration: none; /* Bỏ gạch chân vì là thẻ a */
        transition: all 0.2s;
    }

    /* Hiệu ứng khi di chuột vào nút chưa chọn */
    .filter-section .btn-outline:hover {
        border-color: #c76739;
        color: #c76739;
        background: #fff5f0;
    }

    /* 3. Bổ sung nhỏ cho nút ĐANG CHỌN (Class .btn-filter đã có trong CSS chung, 
       chỉ thêm display flex để căn giữa chữ khi dùng thẻ <a>) */
    .filter-section .btn-filter {
        display: flex;
        align-items: center;
        text-decoration: none; 
    }
</style>
</head>
<body>
<div class="left-menu" id="left-menu">
        <div class="logo">
            <img src="/static/main/img/logo.png" onclick="location.href='{% url 'index' %}'" width="300px" height="100px">
        </div>
    <div class="menu">
        <a href="{% url 'adminPage1' %}" class="menu-item active">Tổng quan</a>
        <a href="{% url 'adminPage2' %}" class="menu-item">Quản lí sản phẩm</a>
        <a href="{% url 'adminPage3' %}" class="menu-item">Quản lí đơn hàng</a>
        <a href="{% url 'adminPage4' %}" class="menu-item">Quản lí tài khoản</a>
        <a href="{% url 'adminPage6' %}" class="menu-item">Quản lí đánh giá</a>
        <a href="{% url 'adminPage7' %}" class="menu-item">Quản lí banner</a>
        <a href="{% url 'adminPage8' %}" class="menu-item">Quản lí mã giảm giá</a>
        <a href="{% url 'adminPage5' %}" class="menu-item">Chăm sóc khách hàng</a>
        <a href="#" class="menu-item" onclick="location.href='{% url 'logout' %}'">Đăng xuất</a>
    </div>
    <div class="footer">
        <p>2024 Aroma Café. All rights reserved.</p>
    </div>
</div>
<div class="right-content" id="right-content">
    <div class="title">
        <button class="slider-menu" id="slider-menu"><i class="fa-solid fa-bars"></i></button>
        <p>TỔNG QUAN</p>
    </div>

    <div class="filter-section" style="display: flex; align-items: center; gap: 15px; margin-top: 20px;">
        
        <form method="GET" action="{% url 'adminPage1' %}" style="margin: 0;">
            <select name="filter" onchange="this.form.submit()" 
                    style="padding: 15px; border-radius: 20px; font-size: 14px;">
                <option value="today" {% if current_filter == 'today' %}selected{% endif %}>Hôm nay</option>
                <option value="week" {% if current_filter == 'week' %}selected{% endif %}>7 ngày qua</option>
                <option value="month" {% if current_filter == 'month' %}selected{% endif %}>30 ngày qua</option>
                <option value="quarter" {% if current_filter == 'quarter' %}selected{% endif %}>1 quý qua</option>
            </select>
        </form>

        <a href="{% url 'adminPage1' %}" 
        style="text-decoration: none; color: #666; font-size: 15px; font-weight: 500;">
        Đặt lại
        </a>

    </div>

    <div class="dashboard-container">
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="card-icon blue">
                    <i class='fas fa-coins'></i>
                </div>
                <div class="card-info">
                    <h3>{{ revenue_today|vn_currency }}đ</h3>
                    <span>Doanh thu hôm nay</span>
                </div>
            </div>

            <div class="kpi-card">
                <div class="card-icon green">
                    <i class='fas fa-box-open'></i>
                </div>
                <div class="card-info">
                    <h3>{{ count_orders_filter }}</h3>
                    <span>Đơn hàng ({{ label_filter }})</span>
                </div>
            </div>

            <div class="kpi-card">
                <div class="card-icon red">
                    <i class='fas fa-clipboard-list'></i>
                </div>
                <div class="card-info">
                    <h3>{{ pending_count }}</h3>
                    <span>Chờ xử lý ({{ label_filter }})</span>
                </div>
            </div>

            <div class="kpi-card">
                <div class="card-icon orange">
                    <i class='fas fa-users'></i>
                </div>
                <div class="card-info">
                    <h3>{{ count_users_filter }}</h3>
                    <span>Khách mới ({{ label_filter }})</span>
                </div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-card large">
                <h3>Tổng doanh thu ({{ label_filter }})</h3>
                <p><span><i class="fa-solid fa-chart-line"></i></span>{{ total_revenue_filter|vn_currency }}đ</p>
                <div style="margin-top: 10px; font-size: 14px; color: #666;">
                    Số liệu được tính tổng dựa trên mốc thời gian bạn đang chọn.
                </div>
            </div>

            <div class="chart-card small" style="text-align: center;">
                <h3>Top sản phẩm ({{ label_filter }})</h3>
                <div class="chart-container" style="display: flex; justify-content: center; align-items: center;">
                    {% if chart_pie_url %}
                        <img src="data:image/png;base64,{{ chart_pie_url }}" 
                             alt="Biểu đồ danh mục" 
                             style="max-width: 100%; max-height: 250px;"> 
                    {% else %}
                        <p style="color: #666; margin-top: 20px;">Không có sản phẩm nào bán ra trong {{ label_filter }}.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="table-card" style="min-height: 400px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>Biểu đồ doanh thu gần đây ({{ label_filter }})</h3>
                </div>
            
            <div style="width: 100%; display: flex; justify-content: center;">
                {% if chart_bar_url %}
                    <img src="data:image/png;base64,{{ chart_bar_url }}" 
                         alt="Biểu đồ doanh thu" 
                         style="width: 100%; height: auto; object-fit: contain;">
                {% else %}
                    <div style="padding: 50px; text-align: center; color: #777;">
                        <i class="fas fa-chart-bar" style="font-size: 40px; margin-bottom: 10px; display: block;"></i>
                        Chưa có dữ liệu doanh thu cho mốc thời gian này.
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
<button class="slide-top" id="slide-top"><i class="fas fa-angle-up"></i></button>
    <script src="{% static 'main/js/admin.js' %}"></script>
</body>
</html>